<meta name="viewport" content="width=device-width, width=device-height, initial-scale=1.0">
<style>
* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}
.root-grid {
    display: grid;
    grid-template-columns: repeat(11, 1fr);
    grid-template-rows: auto 26px 26px;
    gap: 4px;

    padding: 10px;
    width: 100vw;
    height: 100vh;
}
h1 {text-align: center;}
section {text-align: center;}
fieldset {
    border: 1px solid silver;
    border-radius: 4px;
}
</style>

<main id="main" class="root-grid">
</main>

<main id="settings-picker" hidden>
    <select id="settings-list" multiple style="grid-column:1/4;grid-row:1/3">
    </select>

    <div style="grid-column:4/12;grid-row:1">
        <h1 id="setting-title">Metronome</h2>
        <section id="setting-description">
        </section>
    </div>

    <fieldset style="grid-column:8/12;grid-row:2/4">
        <p id="rom-details"></p>
    </fieldset>

    <button id="randomize-button"
        style="grid-column:4/8;grid-row:2"
        disabled=true>
        Randomize!
    </button>

    <input id="choose-rom-input"
        style="grid-column:4/8;grid-row:3"
        type="file"/>
    <button id="new-setting-button"
        onclick='newSetting()'
        style="grid-column:1;grid-row:3">
        New
    </button>
    <button id="edit-setting-button"
        style="grid-column:2;grid-row:3"
        disabled=true>
        Edit
    </button>
    <button id="delete-setting-button"
        style="grid-column:3;grid-row:3"
        disabled=true>
        Delete
    </button>
</main>

<main id="setting-editor" hidden>
    <select id="command-list" multiple style="grid-column:1/4;grid-row:1/3">
    </select>

    <div style="grid-column:4/12;grid-row:1">
    </div>

    <input id="setting-name"
        style="grid-column:4/8;grid-row:2/4"/>
    <input id="setting-description"
        style="grid-column:8/12;grid-row:2/4">
    </input >

    <button id="new-setting-button"
        style="grid-column:1;grid-row:3">
        New
    </button>
    <button id="delete-setting-button"
        style="grid-column:2;grid-row:3"
        disabled=true>
        Delete
    </button>
</main>

<script>
let settings_picker = document.getElementById("settings-picker");
let setting_editor = document.getElementById("setting-editor");
let main = document.getElementById("main");

function switchToPicker() {
    main.innerHTML = settings_picker.innerHTML;
    updateSettingsList();
}

function switchToEditor() { main.innerHTML = setting_editor.innerHTML; }

let current_setting_index = null;
let current_settings = [];
function setSettingsInfo(index) {
    current_setting_index = index;
    let current_setting = current_settings[current_setting_index];
    document.getElementById("setting-title").innerHTML = current_setting.name;
    document.getElementById("setting-description").innerHTML = current_setting.description;
    document.getElementById("edit-setting-button").disabled = false;
    document.getElementById("delete-setting-button").disabled = false;
}

function newSetting() {
    // document.getElementById("settings-picker").innerHTML = setting_editor;
    // document.getElementById("setting-editor").innerHTML = "";

    current_settings.push({
        name: "New Setting",
        description: "Something new has been born",
    });
    setSettingsInfo(current_settings.length - 1);
    updateSettingsList();
    // switchToEditor();
}

function updateSettingsList() {
    document.getElementById("settings-list").innerHTML = current_settings.reduce(
        (list, setting, index) => {
            let selected_html = current_setting_index == index ? "selected=true" : "";
            return list + "<option " + selected_html + " onclick='setSettingsInfo(" + index + ")'>"
                + setting.name + "</option>";
        },
        "",
    );
}

tm35GetSettings().then(settings => {
    current_settings = settings;
    switchToPicker();
});

</script>

